<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="profile">
     
    <select id="selectProfileList" resultType="Profileboard">
    	<include refid="pagingHeader"></include>
        <![CDATA[
            SELECT 
            ROWNUM,
            USER_ID,
            USER_NICKNM,
            GRADE_AVG,
            PICTURE_NM,
            GENDER,
            AGE,
            HEIGHT,            
            AREA,
            HOBBY,
            ACHIEVEMENT,
            BLOOD_TYPE,
            SMOKING,
            DRINKING,
            RELIGION,
            STYLE,
            BODYFORM
            FROM TB_USER 
			LEFT JOIN TB_PROFILE USING (USER_ID)
			LEFT JOIN TB_PROFILE_PICTURE USING (USER_ID)
			WHERE USER_ID != 'admin'
			AND THUMNAIL_FL = '0'
        ]]>
        <include refid="search"></include>
        <include refid="pagingFooter"></include>
    </select>
    
    <sql id="search">
			AND USER_NICKNM like '%'||#{keyword}||'%'
	</sql>

	<sql id="pagingHeader">
   SELECT * FROM (
        SELECT ROWNUM AS rn, A.* FROM (
	</sql>

	<sql id="pagingFooter">
        ) A
    ) WHERE rn BETWEEN #{start} AND #{end}
	</sql>

    <select id="countProfile" resultType="int">
    	<![CDATA[
    	SELECT COUNT(*) FROM TB_USER
    	WHERE USER_NICKNM like '%'||#{keyword}||'%'
    	 ]]>
    </select>
    
    <select id="selectProfileDetail" resultType="Profileboard">
        <![CDATA[
            SELECT * FROM TB_USER 
			LEFT JOIN TB_PROFILE USING(USER_ID)
			LEFT JOIN TB_PROFILE_PICTURE USING (USER_ID)
			WHERE USER_NICKNM = #{USER_NICKNM}
			AND THUMNAIL_FL = '0'
        ]]>
    </select>
    
     <!-- 내프로필 설정 -->
    <select id="myprofile" parameterType="String" resultType="Profile">
     <![CDATA[
    	SELECT    	
    	USER_ID,
    	target_gb,    	   	
    	GENDER,
    	BLOOD_TYPE,
    	JOB,
    	ACHIEVEMENT,
    	PHONE,
    	AGE,
    	AREA,
    	STYLE,
    	HEIGHT,
    	BODYFORM,
    	RELIGION,
    	DRINKING,
    	SMOKING    	
    	FROM TB_USER
    	LEFT JOIN TB_PROFILE USING(USER_ID)
    	WHERE USER_ID = #{user_id} AND target_gb = '0'
    	 ]]>
    	
    </select>
    
    <!-- 내 프로필 수정 -->
   <update id="myprofileset" parameterType="Profile">
   <![CDATA[
    UPDATE TB_PROFILE
    SET
    	GENDER = #{gender},
		BLOOD_TYPE = #{blood_type},
		JOB = #{job},
		ACHIEVEMENT = #{achievement},		
		AGE = #{age},
		AREA = #{area},
		STYLE = #{style},
		HEIGHT = #{height},
		BODYFORM = #{bodyform},
		RELIGION = #{religion},
		DRINKING = #{drinking},
		SMOKING = #{smoking}
		
	WHERE
		USER_ID = #{user_id} 
     ]]>
    </update>
   
    
    <!-- 이상형 프로필 설정 -->
    <select id="idealprofile" parameterType="String" resultType="Profile">
    <![CDATA[
    	SELECT    	
    	USER_ID,
    	target_gb,    	   	
    	GENDER,
    	BLOOD_TYPE,
    	JOB,
    	ACHIEVEMENT,
    	PHONE,
    	AGE,
    	AREA,
    	STYLE,
    	HEIGHT,
    	BODYFORM,
    	RELIGION,
    	DRINKING,
    	SMOKING    	
    	FROM TB_USER
    	LEFT JOIN TB_PROFILE USING(USER_ID)
    	WHERE USER_ID = #{user_id} AND target_gb = '1'
    	 ]]>
    	
    </select>
   
</mapper>